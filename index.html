<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Killing Time Games</title>
    <!-- Tailwind CSS CDN for easy styling and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a new vibrant, clean color palette */
        :root {
            --primary-accent: #4CAF50; /* Vibrant Green for primary actions */
            --secondary-accent: #2196F3; /* Bright Blue for secondary accents/headers */
            --background-main: #000000; /* Pure black for main background */
            --card-background: #1a1a1a; /* Very dark grey for main content cards */
            --background-input: #2c2c2c; /* Slightly lighter dark grey for input fields */
            
            --text-primary: #ffffff; /* Pure white for main text */
            --text-secondary: #e0e0e0; /* Lighter grey for descriptions/subtitles */
            --text-placeholder: #a0a0a0; /* Clear, visible grey for placeholder text */

            --border-color: #333333; /* Darker grey for subtle borders */
            --shadow-subtle: rgba(255, 255, 255, 0.05); /* Subtle light inner shadow */
            --shadow-medium: rgba(0, 0, 0, 0.5); /* Stronger card shadow */
            --shadow-strong: rgba(76, 175, 80, 0.6); /* Stronger green shadow for primary buttons */
            --shadow-active: rgba(76, 175, 80, 0.7); /* Even stronger green button hover/active shadow */

            --red-message: #EF5350; /* Red for error messages */
            --green-message: #66BB6A; /* Green for success messages */
            
            /* Specific game button gradients */
            --coin-gradient-start: #FFD700; /* Gold */
            --coin-gradient-end: #FFA500;   /* Orange */
            --oe-gradient-start: #9C27B0; /* Deep Purple */
            --oe-gradient-end: #673AB7;   /* Darker Purple */
        }

        body {
            font-family: 'Inter', sans-serif; /* Keeping Inter for excellent readability */
            background-color: var(--background-main);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better scrolling on small screens */
            min-height: 100vh;
            margin: 0;
            padding: 24px; /* Increased padding */
            box-sizing: border-box;
            color: var(--text-primary); /* Default text color */
        }
        .game-container {
            max-width: 800px;
            width: 100%;
            background-color: var(--card-background);
            padding: 32px; /* More padding inside the card */
            border-radius: 16px; /* More rounded corners */
            box-shadow: 0 8px 24px var(--shadow-medium); /* Softer, more pronounced shadow */
            text-align: center;
            margin-top: 40px; /* More margin from the top */
            border: 1px solid var(--border-color); /* Subtle border */
        }
        h1 {
            background-image: linear-gradient(to right, var(--primary-accent), var(--secondary-accent)); /* Green to Blue gradient */
            padding: 25px; /* Increased padding for the title bar - increased from 20px */
            border-radius: 12px; /* Slightly less rounded than container */
            box-shadow: 0 4px 12px var(--shadow-medium);
            font-size: 5rem; /* Significantly larger title font */
            color: white; /* Text color for the gradient background */
            font-weight: 900; /* Max boldness */
            text-transform: uppercase; /* Make it uppercase for more impact */
            margin-bottom: 24px; /* Adjusted margin-bottom for larger title */
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4); /* More pronounced text shadow */
        }
        h2 {
            color: var(--secondary-accent); /* Bright Blue for section titles */
            font-size: 2rem; /* Larger section title font */
            margin-bottom: 16px;
        }
        p {
            color: var(--text-primary);
        }
        .text-gray-600 { /* For descriptions */
            color: var(--text-secondary);
        }
        .text-gray-700 { /* For labels/mode displays - now uses text-primary for better visibility */
             color: var(--text-primary);
        }
        .tab-button {
            padding: 12px 24px;
            border-radius: 10px; /* Slightly rounded tabs */
            font-weight: 500; /* Medium font weight */
            color: var(--text-secondary);
            background-color: var(--background-main); /* Uses main background for inactive tabs */
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 0.5px 1px var(--shadow-subtle); /* Subtle inner shadow */
        }
        .tab-button.active {
            background-color: var(--primary-accent); /* Primary Green for active tab */
            color: white;
            box-shadow: 0 2px 6px var(--shadow-strong); /* Green shadow for active tab */
        }
        .tab-button:hover:not(.active) {
            background-color: #0d0d0d; /* Slightly darker hover for inactive tabs */
        }
        .mode-button {
            background-color: var(--background-main); /* Uses main background for mode buttons */
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 1px 2px var(--shadow-subtle);
        }
        .mode-button:hover {
            background-color: #0d0d0d;
            color: var(--text-primary);
        }
        .mode-button.active-mode {
            background-color: var(--primary-accent) !important;
            color: white !important;
            box-shadow: 0 2px 6px var(--shadow-strong);
        }
        .custom-rules-container {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            background-color: var(--background-main); /* Uses a lighter background for inner sections */
            box-shadow: inset 0 1px 3px var(--shadow-subtle);
        }
        .custom-rule-input,
        select,
        input[type="number"] {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary); /* Ensures text is white */
            background-color: var(--background-input); /* New, slightly lighter dark grey */
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .custom-rule-input::placeholder { /* Styling for placeholder text */
            color: var(--text-placeholder); /* Clear, visible grey */
            opacity: 1; /* Ensure full opacity */
        }
        select option { /* Ensure options in dropdown are readable */
            background-color: var(--background-input);
            color: var(--text-primary);
        }
        .custom-rule-input:focus,
        select:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-accent); /* Green border on focus */
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.15); /* Softer focus ring */
        }
        button:not(.tab-button):not(.mode-button) { /* Generic button styling */
            background-color: var(--primary-accent); /* Primary Green */
            color: white;
            font-weight: 600; /* Semibold */
            padding: 12px 28px; /* Larger padding */
            border-radius: 10px; /* Consistent rounded corners */
            box-shadow: 0 4px 10px var(--shadow-strong);
            transition: all 0.2s ease-in-out;
            border: none;
            cursor: pointer;
        }
        button:not(.tab-button):not(.mode-button):hover {
            background-color: #43A047; /* Darker green on hover */
            box-shadow: 0 6px 16px var(--shadow-active);
            transform: translateY(-2px); /* Slight lift effect */
        }
        button:not(.tab-button):not(.mode-button):active {
            transform: translateY(0);
            box-shadow: 0 2px 8px var(--shadow-strong);
        }
        .text-purple-700 { /* Adjusting result text color to secondary accent */
            color: var(--secondary-accent);
        }
        .text-indigo-700 { /* Adjusting choice display text color to primary accent */
            color: var(--primary-accent);
        }
        .bg-gray-50 { /* Scoreboard and Mode Selection background */
            background-color: var(--background-main); /* Changed to Pure Black */
            border-radius: 12px;
            box-shadow: inset 0 1px 3px var(--shadow-subtle);
            /* The text color for this class will be explicitly set to black using !text-black where needed */
        }
        /* Specific adjustments for coin flip buttons */
        .coin-flip-button {
            background-image: linear-gradient(to bottom right, var(--coin-gradient-start), var(--coin-gradient-end));
            box-shadow: 0 4px 10px rgba(255, 165, 0, 0.3);
        }
        .coin-flip-button:hover {
            background-image: linear-gradient(to bottom right, #E6C200, #E09400);
            box-shadow: 0 6px 16px rgba(255, 165, 0, 0.4);
        }
        /* Specific adjustments for odds/evens buttons */
        .oe-choice-button {
            background-image: linear-gradient(to bottom right, var(--oe-gradient-start), var(--oe-gradient-end));
            box-shadow: 0 4px 10px rgba(103, 58, 183, 0.3);
        }
        .oe-choice-button:hover {
            background-image: linear-gradient(to bottom right, #8D24A0, #5A32A1);
            box-shadow: 0 6px 16px rgba(103, 58, 183, 0.4);
        }
        /* Ensuring messages look good */
        p.text-sm {
            color: var(--text-secondary);
        }
        p.text-sm.text-red-500 {
            color: var(--red-message) !important;
        }
        p.text-sm.text-green-600 {
            color: var(--green-message) !important;
        }
        /* Style for game history display */
        .game-history-container {
            background-color: var(--background-main); /* Changed to Pure Black */
            border-radius: 12px;
            padding: 16px;
            margin-top: 24px;
            box-shadow: inset 0 1px 3px var(--shadow-subtle);
            text-align: left;
            max-height: 200px; /* Limit height for scrollability */
            overflow-y: auto; /* Enable scrolling */
            border: 1px solid var(--border-color);
        }
        .game-history-container h3 {
            color: var(--secondary-accent);
            font-size: 1.2rem;
            margin-bottom: 12px;
            text-align: center;
        }
        .game-history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .game-history-list li {
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .game-history-list li:last-child {
            border-bottom: none;
        }
        .game-history-list li strong {
            color: var(--text-primary);
        }
        .game-history-list li.win {
            color: var(--green-message);
        }
        .game-history-list li.loss {
            color: var(--red-message);
        }
        .game-history-list li.tie {
            color: var(--text-secondary);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen">

    <div class="game-container">
        <h1 class="font-bold mb-6 text-white">
            Killing Time Games: Mindless Games to Kill Time
        </h1>

        <!-- Tab Navigation -->
        <div class="flex justify-center space-x-4 mb-8">
            <button id="rpsTab" class="tab-button active">
                Rock Paper Scissors
            </button>
            <button id="coinFlipTab" class="tab-button">
                Coin Flip
            </button>
            <button id="oddsEvensTab" class="tab-button">
                Odds & Evens
            </button>
        </div>

        <!-- Game Sections -->
        <div id="rpsGame" class="game-section">
            <h2 class="font-bold mb-4">Rock Paper Scissors</h2>
            <p class="mb-6">Choose your move and play against the computer!</p>
            
            <!-- RPS Mode Selection -->
            <div class="flex flex-col items-center mb-6 bg-gray-50 p-4 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold mb-3 !text-black">Select Game Mode:</h3>
                <div class="flex flex-wrap justify-center gap-3 mb-4">
                    <button id="modeRPSClassic" class="rps-mode-button mode-button active-mode">Classic</button>
                    <button id="modeRPSCustomFun" class="rps-mode-button mode-button">Fun Option</button>
                    <button id="modeRPSCreateNew" class="rps-mode-button mode-button">Create New</button>
                    <button id="modeRPSLoadSaved" class="rps-mode-button mode-button">Load Saved</button>
                </div>

                <!-- Create New Custom Rules UI -->
                <div id="createNewRPSRules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Create New Custom Game Names</h4>
                    <input type="text" id="newRPSGameName" placeholder="Enter game name (e.g., Animals RPS)" class="w-full mb-3 custom-rule-input">
                    <input type="text" id="customRPSRock" placeholder="Name for 'Rock' (e.g., Lion)" class="w-full mb-2 custom-rule-input">
                    <input type="text" id="customRPSPaper" placeholder="Name for 'Paper' (e.g., Tree)" class="w-full mb-2 custom-rule-input">
                    <input type="text" id="customRPSScissors" placeholder="Name for 'Scissors' (e.full mb-3 custom-rule-input">
                    <button id="saveNewRPSCustomRules">Save & Use New Game</button>
                    <p id="newRPSCustomGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>

                <!-- Load Saved Custom Rules UI -->
                <div id="loadSavedRPSRules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Load a Saved Custom Game</h4>
                    <select id="savedRPSGameSelect" class="w-full mb-3 custom-rule-input">
                        <option value="">-- Select a Saved Game --</option>
                    </select>
                    <button id="loadSelectedRPSCustomRules" style="background-color: var(--green-message); box-shadow: 0 4px 10px rgba(52, 199, 89, 0.25);">Load Selected Game</button>
                    <p id="loadRPSCustomGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>
            </div>

            <!-- Player Name Input for RPS -->
            <div class="mb-6">
                <label for="rpsPlayerNameInput" class="block text-lg font-medium mb-2 text-gray-700">Your Name:</label>
                <input type="text" id="rpsPlayerNameInput" placeholder="Enter your name (e.g., Player 1)" class="w-full mb-4 custom-rule-input text-center">
            </div>

            <!-- Game Controls -->
            <p id="rpsCurrentMode" class="text-xl font-semibold mb-4">Current Mode: Classic Rock Paper Scissors</p>
            <div id="rpsButtonsContainer" class="flex justify-center space-x-4 mb-6">
                <!-- Buttons will be dynamically updated based on mode -->
            </div>

            <!-- Game Output -->
            <div class="text-lg mb-4">
                <p><span id="rpsPlayerDisplayChoice" class="font-semibold italic text-indigo-700">You</span> chose: <span id="rpsPlayerChoice" class="font-semibold italic text-indigo-700"></span></p>
                <p>Computer chose: <span id="rpsComputerChoice" class="font-semibold italic text-indigo-700"></span></p>
            </div>
            <p id="rpsResult" class="text-2xl font-bold text-purple-700 mb-4"></p>

            <!-- Scoreboard -->
            <div class="text-xl font-semibold bg-gray-50 p-4 shadow-inner !text-black">
                Series Score: <span id="rpsPlayerScore">0</span> - <span id="rpsComputerScore">0</span>
                <p class="text-sm text-gray-600 mt-2 !text-black">Overall Series Wins: <span id="rpsTotalPlayerSeriesWinsText">You</span> <span id="rpsTotalPlayerSeriesWins">0</span> - Computer <span id="rpsTotalComputerSeriesWins">0</span></p>
            </div>

            <!-- RPS Game History -->
            <div class="game-history-container">
                <h3>Round History</h3>
                <ul id="rpsGameHistoryList" class="game-history-list">
                    <!-- History items will be inserted here -->
                </ul>
            </div>
        </div>

        <div id="coinFlipGame" class="game-section hidden">
            <h2 class="font-bold mb-4">Coin Flip</h2>
            <p class="mb-6">Choose your side and see what luck brings!</p>

            <!-- Coin Flip Mode Selection -->
            <div class="flex flex-col items-center mb-6 bg-gray-50 p-4 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold mb-3 !text-black">Select Game Mode:</h3>
                <div class="flex flex-wrap justify-center gap-3 mb-4">
                    <button id="modeCFClassic" class="coin-mode-button mode-button active-mode">Classic</button>
                    <button id="modeCFCustomFun" class="coin-mode-button mode-button">Fun Option</button>
                    <button id="modeCFCreateNew" class="coin-mode-button mode-button">Create New</button>
                    <button id="modeCFLoadSaved" class="coin-mode-button mode-button">Load Saved</button>
                </div>

                <!-- Custom Fun Presets UI -->
                <div id="customFunCFRules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Select a Fun Option Preset:</h4>
                    <select id="presetCFGameSelect" class="w-full mb-3 custom-rule-input">
                        <option value="">-- Select a Preset --</option>
                    </select>
                    <button id="loadSelectedCFPreset" style="background-color: var(--oe-gradient-start); box-shadow: 0 4px 10px rgba(156, 39, 176, 0.25);">Load Preset</button>
                    <p id="presetCFGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>

                <!-- Create New Custom Coin Rules UI -->
                <div id="createNewCFRules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Create New Custom Coin Sides</h4>
                    <input type="text" id="newCFGameName" placeholder="Enter game name (e.g., Heroes vs Villains)" class="w-full mb-3 custom-rule-input">
                    <input type="text" id="customCFSide1" placeholder="Name for Side 1 (e.g., Sun)" class="w-full mb-2 custom-rule-input">
                    <input type="text" id="customCFSide2" placeholder="Name for Side 2 (e.g., Moon)" class="w-full mb-3 custom-rule-input">
                    <button id="saveNewCFCustomRules">Save & Use New Game</button>
                    <p id="newCFCustomGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>

                <!-- Load Saved Custom Coin Rules UI -->
                <div id="loadSavedCFRules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Load a Saved Custom Game</h4>
                    <select id="savedCFGameSelect" class="w-full mb-3 custom-rule-input">
                        <option value="">-- Select a Saved Game --</option>
                    </select>
                    <button id="loadSelectedCFCustomRules" style="background-color: var(--green-message); box-shadow: 0 4px 10px rgba(52, 199, 89, 0.25);">Load Selected Game</button>
                    <p id="loadCFCustomGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>
            </div>

            <!-- Player Name Input for Coin Flip -->
            <div class="mb-6">
                <label for="cfPlayerNameInput" class="block text-lg font-medium mb-2 text-gray-700">Your Name:</label>
                <input type="text" id="cfPlayerNameInput" placeholder="Enter your name (e.g., Player 1)" class="w-full mb-4 custom-rule-input text-center">
            </div>

            <!-- Game Controls -->
            <p id="coinFlipCurrentMode" class="text-xl font-semibold mb-4">Current Mode: Classic Coin Flip</p>
            <div class="flex justify-center space-x-4 mb-6">
                <button data-choice="Heads" class="coin-flip-button font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 hover:scale-105"></button>
                <button data-choice="Tails" class="coin-flip-button font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 hover:scale-105"></button>
            </div>

            <!-- Game Output -->
            <p id="coinFlipResult" class="text-2xl font-bold text-purple-700 mb-4"></p>
            <div class="text-xl font-semibold bg-gray-50 p-4 rounded-lg shadow-inner !text-black">
                Series Score: <span id="coinFlipPlayerScore">0</span> - <span id="coinFlipComputerScore">0</span> | Ties: <span id="coinFlipTies">0</span>
                <p class="text-sm text-gray-600 mt-2 !text-black">Overall Series Wins: <span id="coinFlipTotalPlayerSeriesWinsText">You</span> <span id="coinFlipTotalPlayerSeriesWins">0</span> - Computer <span id="coinFlipTotalComputerSeriesWins">0</span></p>
            </div>

            <!-- Coin Flip Game History -->
            <div class="game-history-container">
                <h3>Round History</h3>
                <ul id="coinFlipGameHistoryList" class="game-history-list">
                    <!-- History items will be inserted here -->
                </ul>
            </div>
        </div>

        <div id="oddsEvensGame" class="game-section hidden">
            <h2 class="font-bold mb-4">Odds & Evens</h2>
            <p class="mb-6">Choose Odds or Evens, pick a number, and see who wins!</p>

            <!-- OE Mode Selection -->
            <div class="flex flex-col items-center mb-6 bg-gray-50 p-4 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold mb-3 !text-black">Select Game Mode:</h3>
                <div class="flex flex-wrap justify-center gap-3 mb-4">
                    <button id="modeOEClassic" class="oe-mode-button mode-button active-mode">Classic</button>
                    <button id="modeOECustomFun" class="oe-mode-button mode-button">Fun Option</button>
                    <button id="modeOECreateNew" class="oe-mode-button mode-button">Create New</button>
                    <button id="modeOELoadSaved" class="oe-mode-button mode-button">Load Saved</button>
                </div>

                <!-- Create New Custom OE Rules UI -->
                <div id="createNewOERules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Create New Custom Odds & Evens Names</h4>
                    <input type="text" id="newOEGameName" placeholder="Enter game name (e.g., Light & Dark)" class="w-full mb-3 custom-rule-input">
                    <input type="text" id="customOEOdds" placeholder="Name for 'Odds' (e.g., Light)" class="w-full mb-2 custom-rule-input">
                    <input type="text" id="customOEEvens" placeholder="Name for 'Evens' (e.g., Dark)" class="w-full mb-3 custom-rule-input">
                    <button id="saveNewOECustomRules">Save & Use New Game</button>
                    <p id="newOECustomGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>

                <!-- Load Saved Custom OE Rules UI -->
                <div id="loadSavedOERules" class="custom-rules-container hidden w-full">
                    <h4 class="text-lg font-semibold mb-2" style="color: var(--secondary-accent);">Load a Saved Custom Game</h4>
                    <select id="savedOEGameSelect" class="w-full mb-3 custom-rule-input">
                        <option value="">-- Select a Saved Game --</option>
                    </select>
                    <button id="loadSelectedOECustomRules" style="background-color: var(--green-message); box-shadow: 0 4px 10px rgba(52, 199, 89, 0.25);">Load Selected Game</button>
                    <p id="loadOECustomGameMessage" class="text-sm text-red-500 mt-2"></p>
                </div>
            </div>

            <!-- Player Name Input for Odds & Evens -->
            <div class="mb-6">
                <label for="oePlayerNameInput" class="block text-lg font-medium mb-2 text-gray-700">Your Name:</label>
                <input type="text" id="oePlayerNameInput" placeholder="Enter your name (e.g., Player 1)" class="w-full mb-4 custom-rule-input text-center">
            </div>

            <!-- Game Controls -->
            <p id="oeCurrentMode" class="text-xl font-semibold mb-4">Current Mode: Classic Odds & Evens</p>
            <div class="flex justify-center space-x-4 mb-6">
                <button data-choice="odds" class="oe-choice-button font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 hover:scale-105"></button>
                <button data-choice="evens" class="oe-choice-button font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 hover:scale-105"></button>
            </div>
            
            <div class="mb-6">
                <label for="playerNumber" class="block text-lg font-medium mb-2">Your Number:</label>
                <input type="number" id="playerNumber" min="1" value="1" class="px-4 py-2 border rounded-lg w-32 text-center text-xl font-bold focus:ring-blue-500 focus:border-blue-500">
            </div>

            <!-- Game Output -->
            <div class="text-lg mb-4">
                <p><span id="oePlayerDisplayChoice" class="font-semibold italic text-indigo-700">You</span> chose: <span id="oePlayerChoice" class="font-semibold italic text-indigo-700"></span></p>
                <p>Computer chose: <span id="oeComputerChoice" class="font-semibold italic text-indigo-700"></span></p>
                <p>Sum: <span id="oeSum" class="font-semibold italic text-indigo-700"></span></p>
            </div>
            <p id="oeResult" class="text-2xl font-bold text-purple-700 mb-4"></p>
            
            <!-- Scoreboard -->
            <div class="text-xl font-semibold bg-gray-50 p-4 rounded-lg shadow-inner !text-black">
                Series Score: <span id="oePlayerScore">0</span> - <span id="oeComputerScore">0</span> | Ties: <span id="oeTies">0</span>
                <p class="text-sm text-gray-600 mt-2 !text-black">Overall Series Wins: <span id="oeTotalPlayerSeriesWinsText">You</span> <span id="oeTotalPlayerSeriesWins">0</span> - Computer <span id="oeTotalComputerSeriesWins">0</span></p>
            </div>

            <!-- Odds & Evens Game History -->
            <div class="game-history-container">
                <h3>Round History</h3>
                <ul id="oeGameHistoryList" class="game-history-list">
                    <!-- History items will be inserted here -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // --- Utility Functions ---
        function getLocalStorageItem(key, defaultValue) {
            const item = localStorage.getItem(key);
            try {
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error("Error parsing localStorage item", key, e);
                return defaultValue;
            }
        }

        function setLocalStorageItem(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        // --- Tab Switching Logic ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const gameSections = document.querySelectorAll('.game-section');

        function showGame(gameId) {
            gameSections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(gameId).classList.remove('hidden');

            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(gameId.replace('Game', 'Tab')).classList.add('active');
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const gameId = button.id.replace('Tab', 'Game');
                showGame(gameId);
            });
        });

        // --- Rock Paper Scissors Game Logic ---
        const RPS_CLASSIC_CHOICES = ['Rock', 'Paper', 'Scissors']; // Capitalized for display
        const RPS_CLASSIC_RULES = {
            'Rock': ['Scissors'],
            'Paper': ['Rock'],
            'Scissors': ['Paper']
        };

        // Updated custom fun choices with capitalization
        const RPS_CUSTOM_FUN_CHOICES = ["The Rock", "Toilet Paper", "Edward Scissorhands"];
        const RPS_CUSTOM_FUN_RULES = {
            "The Rock": ["Edward Scissorhands"],
            "Toilet Paper": ["The Rock"],
            "Edward Scissorhands": ["Toilet Paper"]
        };

        let currentRPSChoices = RPS_CLASSIC_CHOICES;
        let currentRPSRules = RPS_CLASSIC_RULES;
        let rpsCurrentModeName = "Classic Rock Paper Scissors";

        // RPS scores for the current series
        let rpsScores = getLocalStorageItem('rpsScores', { player: 0, computer: 0, ties: 0 }); 
        // Total series wins for RPS
        let rpsTotalSeriesWins = getLocalStorageItem('rpsTotalSeriesWins', { player: 0, computer: 0 });
        let savedCustomRPSRules = getLocalStorageItem('savedCustomRPSRules', {});
        // RPS Game History for current series
        let rpsGameHistory = getLocalStorageItem('rpsGameHistory', []);


        // DOM Elements for RPS (Declared inside DOMContentLoaded for safety)
        let rpsPlayerNameInput, rpsPlayerScoreElem, rpsComputerScoreElem, rpsPlayerChoiceElem, rpsComputerChoiceElem, rpsResultElem, rpsCurrentModeDisplay, rpsButtonsContainer, rpsPlayerDisplayChoice, rpsTotalPlayerSeriesWinsElem, rpsTotalComputerSeriesWinsElem, rpsTotalPlayerSeriesWinsText;
        let modeRPSClassicBtn, modeRPSCustomFunBtn, modeRPSCreateNewBtn, modeRPSLoadSavedBtn;
        let createNewRPSRulesContainer, loadSavedRPSRulesContainer, newRPSGameNameInput, customRPSRockInput, customRPSPaperInput, customRPSSciInput, saveNewRPSCustomRulesBtn, newRPSCustomGameMessage, savedRPSGameSelect, loadSelectedRPSCustomRulesBtn, loadRPSCustomGameMessage;
        let rpsGameHistoryListElem; // New element for RPS history


        function updateRPSScoreboard() {
            const playerName = rpsPlayerNameInput.value.trim() || 'You'; // Get current player name
            rpsPlayerScoreElem.textContent = rpsScores.player;
            rpsComputerScoreElem.textContent = rpsScores.computer;
            rpsTotalPlayerSeriesWinsElem.textContent = rpsTotalSeriesWins.player;
            rpsTotalComputerSeriesWinsElem.textContent = rpsTotalSeriesWins.computer;
            // Update player name display in scoreboard
            rpsTotalPlayerSeriesWinsText.textContent = playerName;
            rpsPlayerDisplayChoice.textContent = playerName;
        }

        function renderRPSHistory() {
            rpsGameHistoryListElem.innerHTML = ''; // Clear existing history
            rpsGameHistory.forEach((round, index) => {
                const listItem = document.createElement('li');
                let resultClass = '';
                if (round.result === 'You Win!') {
                    resultClass = 'win';
                } else if (round.result === 'Computer Wins!') {
                    resultClass = 'loss';
                } else {
                    resultClass = 'tie';
                }
                listItem.classList.add(resultClass);
                listItem.innerHTML = `Round ${round.roundNumber}: <strong>${round.playerChoice}</strong> vs. Computer <strong>${round.computerChoice}</strong> - ${round.result}`;
                rpsGameHistoryListElem.appendChild(listItem);
            });
            // Scroll to bottom to show latest entry
            rpsGameHistoryListElem.scrollTop = rpsGameHistoryListElem.scrollHeight;
        }


        function createRPSButtons(choices) {
            rpsButtonsContainer.innerHTML = ''; // Clear existing buttons
            choices.forEach(choice => {
                const button = document.createElement('button');
                button.textContent = choice; // Use the choice directly (already capitalized)
                button.dataset.choice = choice;
                // Use primary accent for RPS buttons
                button.classList.add('rps-button', 'font-bold', 'py-3', 'px-6', 'rounded-lg', 'shadow-md', 'transition-all', 'duration-200', 'hover:scale-105', 'bg-green-500', 'text-white', 'hover:bg-green-600'); 
                button.addEventListener('click', (e) => playRPS(e.target.dataset.choice));
                rpsButtonsContainer.appendChild(button);
            });
        }

        function setRPSMode(mode, name = "") {
            // Hide all custom rule containers
            createNewRPSRulesContainer.classList.add('hidden');
            loadSavedRPSRulesContainer.classList.add('hidden');
            // Clear messages
            newRPSCustomGameMessage.textContent = "";
            loadRPSCustomGameMessage.textContent = "";

            rpsButtonsContainer.innerHTML = ''; // Clear buttons initially

            if (mode === 'classic') {
                currentRPSChoices = RPS_CLASSIC_CHOICES;
                currentRPSRules = RPS_CLASSIC_RULES;
                rpsCurrentModeName = "Classic Rock Paper Scissors";
                createRPSButtons(currentRPSChoices);
            } else if (mode === 'customFun') {
                currentRPSChoices = RPS_CUSTOM_FUN_CHOICES;
                currentRPSRules = RPS_CUSTOM_FUN_RULES;
                rpsCurrentModeName = "The Rock, Toilet Paper, Edward Scissorhands (Fun Option)"; // Updated mode name
                createRPSButtons(currentRPSChoices);
            } else if (mode === 'createNew') {
                rpsCurrentModeName = "Create New Custom Game"; // This mode doesn't allow playing until saved
                createNewRPSRulesContainer.classList.remove('hidden');
                // Don't create game buttons until rules are saved
                rpsButtonsContainer.innerHTML = '<p class="text-gray-600">Enter custom names above to start playing this mode.</p>';
            } else if (mode === 'loadSaved') {
                rpsCurrentModeName = "Load Saved Custom Game"; // This mode doesn't allow playing until loaded
                loadSavedRPSRulesContainer.classList.remove('hidden');
                populateSavedRPSGamesDropdown();
                // Don't create game buttons until rules are loaded
                rpsButtonsContainer.innerHTML = '<p class="text-gray-600">Select and load a saved game above to start playing.</p>';
            } else if (mode === 'loadedCustom') { // For when a custom game is actually loaded
                currentRPSRules = savedCustomRPSRules[name];
                currentRPSChoices = Object.keys(currentRPSRules);
                rpsCurrentModeName = `Loaded Custom Game: ${name}`;
                createRPSButtons(currentRPSChoices);
            }

            rpsCurrentModeDisplay.textContent = `Current Mode: ${rpsCurrentModeName}`;
            // Reset scores on mode change
            rpsScores = { player: 0, computer: 0, ties: 0 }; // Reset ties here too
            rpsGameHistory = []; // Clear history on mode change
            updateRPSScoreboard();
            renderRPSHistory(); // Re-render history (now empty)
            rpsResultElem.textContent = ""; // Clear previous result message
            rpsPlayerChoiceElem.textContent = "";
            rpsComputerChoiceElem.textContent = "";


            // Update active mode button styling
            document.querySelectorAll('.rps-mode-button').forEach(btn => btn.classList.remove('active-mode'));
            if (mode === 'classic') modeRPSClassicBtn.classList.add('active-mode');
            else if (mode === 'customFun') modeRPSCustomFunBtn.classList.add('active-mode');
            else if (mode === 'createNew') modeRPSCreateNewBtn.classList.add('active-mode');
            else if (mode === 'loadSaved') modeRPSLoadSavedBtn.classList.add('active-mode');
            else if (mode === 'loadedCustom' && name) { 
                 // No specific button for 'loadedCustom', so ensure all are inactive if coming from load/create
            }
        }

        function playRPS(playerChoice) {
            // If a series has already ended, reset scores for a new series
            if (rpsScores.player >= 2 || rpsScores.computer >= 2) {
                rpsScores = { player: 0, computer: 0, ties: 0 };
                rpsGameHistory = []; // Clear history for new series
                updateRPSScoreboard();
                renderRPSHistory();
                rpsResultElem.textContent = "";
                rpsPlayerChoiceElem.textContent = "";
                rpsComputerChoiceElem.textContent = "";
            }

            // Player choice is already in correct casing from button text
            const computerChoice = currentRPSChoices[Math.floor(Math.random() * currentRPSChoices.length)];

            rpsPlayerChoiceElem.textContent = playerChoice;
            rpsComputerChoiceElem.textContent = computerChoice;

            let resultText = '';
            let winnerIndicator = ''; // 'user', 'computer', 'tie'
            let seriesWinner = null; // Track series winner for overall score
            // Check rules: currentRPSRules[playerChoice] should contain an array of what playerChoice beats
            if (playerChoice === computerChoice) {
                resultText = "It's a Tie!";
                winnerIndicator = 'tie';
                rpsScores.ties++;
            } else if (currentRPSRules[playerChoice] && currentRPSRules[playerChoice].includes(computerChoice)) {
                resultText = "You Win!";
                winnerIndicator = 'user';
                rpsScores.player++;
            } else if (currentRPSRules[computerChoice] && currentRPSRules[computerChoice].includes(playerChoice)) {
                resultText = "Computer Wins!";
                winnerIndicator = 'computer';
                rpsScores.computer++;
            } else {
                resultText = "Something went wrong with rules!"; // Fallback for unexpected rule issues
                winnerIndicator = 'tie';
            }
            rpsResultElem.textContent = resultText;
            updateRPSScoreboard();
            setLocalStorageItem('rpsScores', rpsScores);

            // Add round to history
            rpsGameHistory.push({
                roundNumber: rpsGameHistory.length + 1,
                playerChoice: playerChoice,
                computerChoice: computerChoice,
                result: resultText,
                winner: winnerIndicator,
                timestamp: new Date().toLocaleTimeString()
            });
            setLocalStorageItem('rpsGameHistory', rpsGameHistory); // Save history to local storage
            renderRPSHistory(); // Update history display


            // Check for series winner and update total series wins
            if (rpsScores.player >= 2) {
                rpsResultElem.textContent = "Series Over! You won the best of three!";
                rpsResultElem.classList.remove('text-purple-700');
                rpsResultElem.classList.add('text-green-600');
                seriesWinner = 'player'; 
            } else if (rpsScores.computer >= 2) {
                rpsResultElem.textContent = "Series Over! Computer won the best of three!";
                rpsResultElem.classList.remove('text-purple-700');
                rpsResultElem.classList.add('text-red-500');
                seriesWinner = 'computer'; 
            } else {
                rpsResultElem.classList.remove('text-green-600', 'text-red-500');
                rpsResultElem.classList.add('text-purple-700');
            }

            // Update total series wins if a series concluded
            if (seriesWinner === 'player') {
                rpsTotalSeriesWins.player++;
                setLocalStorageItem('rpsTotalSeriesWins', rpsTotalSeriesWins);
                updateRPSScoreboard(); // Update display immediately
            } else if (seriesWinner === 'computer') {
                rpsTotalSeriesWins.computer++;
                setLocalStorageItem('rpsTotalSeriesWins', rpsTotalSeriesWins);
                updateRPSScoreboard(); // Update display immediately
            }
        }

        // --- Coin Flip Game Logic ---
        const CF_CLASSIC_SIDES = ["Heads", "Tails"];
        const CF_CUSTOM_FUN_PRESETS = {
            "Obama and Trump": ["Obama", "Trump"],
            "2pac and Biggie": ["2pac", "Biggie"],
            "Drake and Kendrick Lamar": ["Drake", "Kendrick Lamar"]
        };
        let currentCFSides = CF_CLASSIC_SIDES;
        let cfCurrentModeName = "Classic Coin Flip";
        let currentCFMode = 'classic'; // To track the active mode for conditional logic in dropdown loading

        // Coin Flip scores for the current series
        let coinFlipScores = getLocalStorageItem('coinFlipScores', { player: 0, computer: 0, ties: 0 });
        // Total series wins for Coin Flip
        let coinFlipTotalSeriesWins = getLocalStorageItem('coinFlipTotalSeriesWins', { player: 0, computer: 0 });
        let savedCustomCFRules = getLocalStorageItem('savedCustomCFRules', {});
        // Coin Flip Game History for current series
        let coinFlipGameHistory = getLocalStorageItem('coinFlipGameHistory', []);


        // DOM Elements for Coin Flip (Declared inside DOMContentLoaded for safety)
        let coinFlipResultElem, coinFlipPlayerScoreElem, coinFlipComputerScoreElem, coinFlipTiesElem;
        let coinFlipButtons; // This will be a NodeList, not a single element
        let coinFlipCurrentModeDisplay, cfPlayerNameInput, coinFlipTotalPlayerSeriesWinsElem, coinFlipTotalComputerSeriesWinsElem, coinFlipTotalPlayerSeriesWinsText;
        let modeCFClassicBtn, modeCFCustomFunBtn, modeCFCreateNewBtn, modeCFLoadSavedBtn;
        let customFunCFRulesContainer, presetCFGameSelect, loadSelectedCFPresetBtn, presetCFGameMessage;
        let createNewCFRulesContainer, newCFGameNameInput, customCFSide1Input, customCFSide2Input, saveNewCFCustomRulesBtn, newCFCustomGameMessage;
        let loadSavedCFRulesContainer, savedCFGameSelect, loadSelectedCFCustomRulesBtn, loadCFCustomGameMessage;
        let coinFlipGameHistoryListElem; // New element for Coin Flip history


        function updateCoinFlipScoreboard() {
            const playerName = cfPlayerNameInput.value.trim() || 'You'; // Get current player name
            coinFlipPlayerScoreElem.textContent = coinFlipScores.player;
            coinFlipComputerScoreElem.textContent = coinFlipScores.computer;
            coinFlipTiesElem.textContent = coinFlipScores.ties;
            coinFlipTotalPlayerSeriesWinsElem.textContent = coinFlipTotalSeriesWins.player;
            coinFlipTotalComputerSeriesWinsElem.textContent = coinFlipTotalSeriesWins.computer;
            // Update player name display in scoreboard
            coinFlipTotalPlayerSeriesWinsText.textContent = playerName;
        }

        function renderCoinFlipHistory() {
            coinFlipGameHistoryListElem.innerHTML = ''; // Clear existing history
            coinFlipGameHistory.forEach((round, index) => {
                const listItem = document.createElement('li');
                let resultClass = '';
                if (round.winner === 'user') {
                    resultClass = 'win';
                } else if (round.winner === 'computer') {
                    resultClass = 'loss';
                } else {
                    resultClass = 'tie';
                }
                listItem.classList.add(resultClass);
                listItem.innerHTML = `Round ${round.roundNumber}: You chose <strong>${round.playerChoice}</strong>, Coin landed on <strong>${round.flipResult}</strong> - ${round.result}`;
                coinFlipGameHistoryListElem.appendChild(listItem);
            });
            coinFlipGameHistoryListElem.scrollTop = coinFlipGameHistoryListElem.scrollHeight;
        }

        function updateCFButtons(side1Name, side2Name) {
            coinFlipButtons[0].textContent = `Flip Coin (${side1Name})`;
            coinFlipButtons[0].dataset.choice = side1Name;
            coinFlipButtons[1].textContent = `Flip Coin (${side2Name})`;
            coinFlipButtons[1].dataset.choice = side2Name;
        }

        function populateCFDropdown(dropdownElement, sourceObject) {
            dropdownElement.innerHTML = '<option value="">-- Select a Game --</option>';
            for (const name in sourceObject) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                dropdownElement.appendChild(option);
            }
        }

        function setCoinFlipMode(mode, name = "") {
            // Hide all custom rule containers
            customFunCFRulesContainer.classList.add('hidden');
            createNewCFRulesContainer.classList.add('hidden');
            loadSavedCFRulesContainer.classList.add('hidden');
            // Clear messages
            presetCFGameMessage.textContent = "";
            newCFCustomGameMessage.textContent = "";
            loadCFCustomGameMessage.textContent = "";

            currentCFMode = mode; // Update the current mode tracker

            if (mode === 'classic') {
                currentCFSides = CF_CLASSIC_SIDES;
                cfCurrentModeName = "Classic Coin Flip";
                updateCFButtons(currentCFSides[0], currentCFSides[1]);
            } else if (mode === 'customFun') {
                cfCurrentModeName = "Fun Option Preset";
                customFunCFRulesContainer.classList.remove('hidden');
                populateCFDropdown(presetCFGameSelect, CF_CUSTOM_FUN_PRESETS);
                // Set default sides if a preset is already selected or first option
                if (presetCFGameSelect.value && CF_CUSTOM_FUN_PRESETS[presetCFGameSelect.value]) {
                    currentCFSides = CF_CUSTOM_FUN_PRESETS[presetCFGameSelect.value];
                    updateCFButtons(currentCFSides[0], currentCFSides[1]);
                } else {
                    // Set to classic or a default message if no preset loaded
                    updateCFButtons("Heads", "Tails"); // Default to classic until preset loaded
                    coinFlipResultElem.textContent = "Select a fun preset above to start playing.";
                }
            } else if (mode === 'createNew') {
                cfCurrentModeName = "Create New Custom Coin";
                createNewCFRulesContainer.classList.remove('hidden');
                updateCFButtons("Side 1", "Side 2"); // Placeholder buttons
                coinFlipResultElem.textContent = "Enter custom names above to start playing this mode.";
            } else if (mode === 'loadSaved') {
                cfCurrentModeName = "Load Saved Custom Coin";
                loadSavedCFRulesContainer.classList.remove('hidden');
                populateCFDropdown(savedCFGameSelect, savedCustomCFRules);
                // Set default sides if a saved game is already selected or first option
                if (savedCFGameSelect.value && savedCustomCFRules[savedCFGameSelect.value]) {
                    currentCFSides = savedCustomCFRules[savedCFGameSelect.value];
                    updateCFButtons(currentCFSides[0], currentCFSides[1]);
                } else {
                    updateCFButtons("Heads", "Tails"); // Default to classic until saved game loaded
                    coinFlipResultElem.textContent = "Select and load a saved game above to start playing.";
                }
            } else if (mode === 'loadedCustom') { // When a custom game is actually loaded (from create or load)
                currentCFSides = savedCustomCFRules[name];
                cfCurrentModeName = `Loaded Custom Game: ${name}`;
                updateCFButtons(currentCFSides[0], currentCFSides[1]);
            } else if (mode === 'loadedPreset') { // When a custom fun preset is loaded
                currentCFSides = CF_CUSTOM_FUN_PRESETS[name];
                cfCurrentModeName = `Fun Preset: ${name}`;
                updateCFButtons(currentCFSides[0], currentCFSides[1]);
            }

            coinFlipCurrentModeDisplay.textContent = `Current Mode: ${cfCurrentModeName}`;
            // Reset scores on mode change
            coinFlipScores = { player: 0, computer: 0, ties: 0 };
            coinFlipGameHistory = []; // Clear history on mode change
            updateCoinFlipScoreboard();
            renderCoinFlipHistory(); // Re-render history (now empty)
            coinFlipResultElem.textContent = ""; // Clear previous result message


            // Update active mode button styling
            document.querySelectorAll('.coin-mode-button').forEach(btn => btn.classList.remove('active-mode'));
            if (mode === 'classic') modeCFClassicBtn.classList.add('active-mode');
            else if (mode === 'customFun') modeCFCustomFunBtn.classList.add('active-mode');
            else if (mode === 'createNew') modeCFCreateNewBtn.classList.add('active-mode');
            else if (mode === 'loadSaved') modeCFLoadSavedBtn.classList.add('active-mode');
        }

        function playCoinFlip(playerChoice) {
            if (currentCFMode === 'createNew' || currentCFMode === 'loadSaved' || (currentCFMode === 'customFun' && !presetCFGameSelect.value)) {
                coinFlipResultElem.textContent = "Please select or create a game mode first!";
                coinFlipResultElem.classList.add('text-red-500');
                return;
            }
            coinFlipResultElem.classList.remove('text-red-500'); // Clear error message

            // If a series has already ended, reset scores for a new series
            if (coinFlipScores.player >= 2 || coinFlipScores.computer >= 2) {
                coinFlipScores = { player: 0, computer: 0, ties: 0 };
                coinFlipGameHistory = []; // Clear history for new series
                updateCoinFlipScoreboard();
                renderCoinFlipHistory();
                coinFlipResultElem.textContent = "";
            }

            const flipResult = currentCFSides[Math.floor(Math.random() * currentCFSides.length)]; // Actual flip result
            let resultText = `You chose ${playerChoice}. The coin landed on ${flipResult}! `;
            let winnerIndicator = ''; // 'user', 'computer', 'tie'
            let seriesWinner = null; 

            if (playerChoice === flipResult) {
                resultText += "You Win!";
                winnerIndicator = 'user';
                coinFlipScores.player++;
            } else {
                resultText += "Computer Wins!"; // Computer wins if player loses
                winnerIndicator = 'computer';
                coinFlipScores.computer++;
            }
            coinFlipResultElem.textContent = resultText;
            updateCoinFlipScoreboard();
            setLocalStorageItem('coinFlipScores', coinFlipScores);

            // Add round to history
            coinFlipGameHistory.push({
                roundNumber: coinFlipGameHistory.length + 1,
                playerChoice: playerChoice,
                flipResult: flipResult,
                result: resultText,
                winner: winnerIndicator,
                timestamp: new Date().toLocaleTimeString()
            });
            setLocalStorageItem('coinFlipGameHistory', coinFlipGameHistory); // Save history to local storage
            renderCoinFlipHistory(); // Update history display


            // Check for series winner and update total series wins
            if (coinFlipScores.player >= 2) {
                coinFlipResultElem.textContent = "Series Over! You won the best of three!";
                coinFlipResultElem.classList.remove('text-purple-700');
                coinFlipResultElem.classList.add('text-green-600');
                seriesWinner = 'player'; 
            } else if (coinFlipScores.computer >= 2) {
                coinFlipResultElem.textContent = "Series Over! Computer won the best of three!";
                coinFlipResultElem.classList.remove('text-purple-700');
                coinFlipResultElem.classList.add('text-red-500');
                seriesWinner = 'computer'; 
            } else {
                coinFlipResultElem.classList.remove('text-green-600', 'text-red-500');
                coinFlipResultElem.classList.add('text-purple-700');
            }

            // Update total series wins if a series concluded
            if (seriesWinner === 'player') {
                coinFlipTotalSeriesWins.player++;
                setLocalStorageItem('coinFlipTotalSeriesWins', coinFlipTotalSeriesWins);
                updateCoinFlipScoreboard(); // Update display immediately
            } else if (seriesWinner === 'computer') {
                coinFlipTotalSeriesWins.computer++;
                setLocalStorageItem('coinFlipTotalSeriesWins', coinFlipTotalSeriesWins);
                updateCoinFlipScoreboard(); // Update display immediately
            }
        }

        // --- Odds & Evens Game Logic ---
        const OE_CLASSIC_CHOICES = ["Odds", "Evens"];
        const OE_CUSTOM_FUN_PRESETS = {
            "Gods and Demons": ["Gods", "Demons"],
            "Light and Dark": ["Light", "Dark"]
        };
        let currentOEChoices = OE_CLASSIC_CHOICES;
        let oeCurrentModeName = "Classic Odds & Evens";
        let currentOEMode = 'classic'; // To track the active mode for conditional logic in dropdown loading

        // Odds & Evens scores for the current series
        let oddsEvensScores = getLocalStorageItem('oddsEvensScores', { player: 0, computer: 0, ties: 0 });
        // Total series wins for Odds & Evens
        let oddsEvensTotalSeriesWins = getLocalStorageItem('oddsEvensTotalSeriesWins', { player: 0, computer: 0 });
        let savedCustomOERules = getLocalStorageItem('savedCustomOERules', {});
        // Odds & Evens Game History for current series
        let oddsEvensGameHistory = getLocalStorageItem('oddsEvensGameHistory', []);


        // DOM Elements for Odds & Evens (Declared inside DOMContentLoaded for safety)
        let oePlayerChoiceElem, oeComputerChoiceElem, oeSumElem, oeResultElem, oePlayerScoreElem, oeComputerScoreElem, oeTiesElem, playerNumberInput;
        let oeChoiceButtons; // This will be a NodeList
        let oeCurrentModeDisplay, oePlayerNameInput, oeTotalPlayerSeriesWinsElem, oeTotalComputerSeriesWinsElem, oeTotalPlayerSeriesWinsText;
        let modeOEClassicBtn, modeOECustomFunBtn, modeOECreateNewBtn, modeOELoadSavedBtn;
        let createNewOERulesContainer, newOEGameNameInput, customOEOddsInput, customOEEvensInput, saveNewOECustomRulesBtn, newOECustomGameMessage;
        let loadSavedOERulesContainer, savedOEGameSelect, loadSelectedOECustomRulesBtn, loadOECustomGameMessage;
        let oeGameHistoryListElem; // New element for OE history


        function updateOddsEvensScoreboard() {
            const playerName = oePlayerNameInput.value.trim() || 'You'; // Get current player name
            oePlayerScoreElem.textContent = oddsEvensScores.player;
            oeComputerScoreElem.textContent = oddsEvensScores.computer;
            oeTiesElem.textContent = oddsEvensScores.ties;
            oeTotalPlayerSeriesWinsElem.textContent = oddsEvensTotalSeriesWins.player;
            oeTotalComputerSeriesWinsElem.textContent = oddsEvensTotalSeriesWins.computer;
            // Update player name display in scoreboard
            oeTotalPlayerSeriesWinsText.textContent = playerName;
            oePlayerDisplayChoice.textContent = playerName;
        }

        function renderOEHistory() {
            oeGameHistoryListElem.innerHTML = ''; // Clear existing history
            oddsEvensGameHistory.forEach((round, index) => {
                const listItem = document.createElement('li');
                let resultClass = '';
                if (round.winner === 'user') {
                    resultClass = 'win';
                } else if (round.winner === 'computer') {
                    resultClass = 'loss';
                } else {
                    resultClass = 'tie';
                }
                listItem.classList.add(resultClass);
                listItem.innerHTML = `Round ${round.roundNumber}: You chose <strong>${round.playerChoiceDisplayName}</strong> (${round.playerNumber}), Computer picked <strong>${round.computerNumber}</strong>, Sum: <strong>${round.sum}</strong> - ${round.result}`;
                oeGameHistoryListElem.appendChild(listItem);
            });
            oeGameHistoryListElem.scrollTop = oeGameHistoryListElem.scrollHeight;
        }

        function updateOEButtons(oddsName, evensName) {
            oeChoiceButtons[0].textContent = oddsName;
            oeChoiceButtons[0].dataset.choice = 'odds'; // Keep internal data-choice as 'odds'
            oeChoiceButtons[1].textContent = evensName;
            oeChoiceButtons[1].dataset.choice = 'evens'; // Keep internal data-choice as 'evens'
        }

        function populateOEDropdown(dropdownElement, sourceObject) {
            dropdownElement.innerHTML = '<option value="">-- Select a Game --</option>';
            for (const name in sourceObject) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                dropdownElement.appendChild(option);
            }
        }

        function setOddsEvensMode(mode, name = "") {
            // Hide all custom rule containers
            createNewOERulesContainer.classList.add('hidden');
            loadSavedOERulesContainer.classList.add('hidden');
            // Clear messages
            newOECustomGameMessage.textContent = "";
            loadOECustomGameMessage.textContent = "";

            currentOEMode = mode; // Update the current mode tracker

            if (mode === 'classic') {
                currentOEChoices = OE_CLASSIC_CHOICES;
                oeCurrentModeName = "Classic Odds & Evens";
                updateOEButtons(currentOEChoices[0], currentOEChoices[1]);
            } else if (mode === 'customFun') {
                oeCurrentModeName = "Fun Option Preset";
                // For Odds & Evens, custom fun presets are directly loaded, not selected from dropdown
                // This UI element is not explicitly present for OE custom fun, so we'll just set it
                // and display a message if needed.
                // For now, let's assume 'Fun Option' directly loads the first preset or a default
                if (Object.keys(OE_CUSTOM_FUN_PRESETS).length > 0) {
                    const firstPresetName = Object.keys(OE_CUSTOM_FUN_PRESETS)[0];
                    currentOEChoices = OE_CUSTOM_FUN_PRESETS[firstPresetName];
                    oeCurrentModeName = `Fun Preset: ${firstPresetName}`;
                    updateOEButtons(currentOEChoices[0], currentOEChoices[1]);
                } else {
                    oeCurrentModeName = "Fun Option (No Presets)";
                    updateOEButtons("Odds", "Evens"); // Fallback to classic names
                    oeResultElem.textContent = "No fun presets available. Playing Classic.";
                }
            } else if (mode === 'createNew') {
                oeCurrentModeName = "Create New Custom Odds & Evens";
                createNewOERulesContainer.classList.remove('hidden');
                updateOEButtons("Odds Name", "Evens Name"); // Placeholder buttons
                oeResultElem.textContent = "Enter custom names above to start playing this mode.";
            } else if (mode === 'loadSaved') {
                oeCurrentModeName = "Load Saved Custom Odds & Evens";
                loadSavedOERulesContainer.classList.remove('hidden');
                populateOEDropdown(savedOEGameSelect, savedCustomOERules);
                // Set default sides if a saved game is already selected or first option
                if (savedOEGameSelect.value && savedCustomOERules[savedOEGameSelect.value]) {
                    currentOEChoices = savedCustomOERules[savedOEGameSelect.value];
                    updateOEButtons(currentOEChoices[0], currentOEChoices[1]);
                } else {
                    updateOEButtons("Odds", "Evens"); // Default to classic until saved game loaded
                    oeResultElem.textContent = "Select and load a saved game above to start playing.";
                }
            } else if (mode === 'loadedCustom') { // When a custom game is actually loaded (from create or load)
                currentOEChoices = savedCustomOERules[name];
                oeCurrentModeName = `Loaded Custom Game: ${name}`;
                updateOEButtons(currentOEChoices[0], currentOEChoices[1]);
            }

            oeCurrentModeDisplay.textContent = `Current Mode: ${oeCurrentModeName}`;
            // Reset scores on mode change
            oddsEvensScores = { player: 0, computer: 0, ties: 0 };
            oddsEvensGameHistory = []; // Clear history on mode change
            updateOddsEvensScoreboard();
            renderOEHistory(); // Re-render history (now empty)
            oeResultElem.textContent = ""; // Clear previous result message
            oePlayerChoiceElem.textContent = "";
            oeComputerChoiceElem.textContent = "";
            oeSumElem.textContent = "";


            // Update active mode button styling
            document.querySelectorAll('.oe-mode-button').forEach(btn => btn.classList.remove('active-mode'));
            if (mode === 'classic') modeOEClassicBtn.classList.add('active-mode');
            else if (mode === 'customFun') modeOECustomFunBtn.classList.add('active-mode');
            else if (mode === 'createNew') modeOECreateNewBtn.classList.add('active-mode');
            else if (mode === 'loadSaved') modeOELoadSavedBtn.classList.add('active-mode');
        }

        function playOddsEvens(playerChoiceType) { // playerChoiceType will be 'odds' or 'evens'
            if (currentOEMode === 'createNew' || currentOEMode === 'loadSaved' || (currentOEMode === 'customFun' && Object.keys(OE_CUSTOM_FUN_PRESETS).length === 0)) {
                oeResultElem.textContent = "Please select or create a game mode first!";
                oeResultElem.classList.add('text-red-500');
                return;
            }
            oeResultElem.classList.remove('text-red-500'); // Clear error message

            // If a series has already ended, reset scores for a new series
            if (oddsEvensScores.player >= 2 || oddsEvensScores.computer >= 2) {
                oddsEvensScores = { player: 0, computer: 0, ties: 0 };
                oddsEvensGameHistory = []; // Clear history for new series
                updateOddsEvensScoreboard();
                renderOEHistory();
                oeResultElem.textContent = "";
                oePlayerChoiceElem.textContent = "";
                oeComputerChoiceElem.textContent = "";
                oeSumElem.textContent = "";
            }

            const playerNumber = parseInt(playerNumberInput.value);
            if (isNaN(playerNumber) || playerNumber < 1) {
                oeResultElem.textContent = "Please enter a valid number (1 or greater).";
                oeResultElem.classList.add('text-red-500');
                return;
            }

            const computerChoice = Math.floor(Math.random() * 10) + 1; // Computer picks a number 1-10
            const sum = playerNumber + computerChoice;

            const isSumEven = sum % 2 === 0;
            const winningChoiceType = isSumEven ? 'evens' : 'odds';

            const playerChoiceDisplayName = playerChoiceType === 'odds' ? currentOEChoices[0] : currentOEChoices[1];
            const winningChoiceDisplayName = winningChoiceType === 'odds' ? currentOEChoices[0] : currentOEChoices[1];

            oePlayerChoiceElem.textContent = `${playerChoiceDisplayName} (You picked ${playerNumber})`;
            oeComputerChoiceElem.textContent = `Computer picked ${computerChoice}`;
            oeSumElem.textContent = sum;

            let resultText = '';
            let winnerIndicator = ''; // 'user', 'computer', 'tie'
            let seriesWinner = null; 
            if (playerChoiceType === winningChoiceType) {
                resultText = `The sum (${sum}) is ${winningChoiceDisplayName}! You Win!`;
                winnerIndicator = 'user';
                oddsEvensScores.player++;
            } else {
                resultText = `The sum (${sum}) is ${winningChoiceDisplayName}! Computer Wins!`;
                winnerIndicator = 'computer';
                oddsEvensScores.computer++;
            }
            oeResultElem.textContent = resultText;
            updateOddsEvensScoreboard();
            setLocalStorageItem('oddsEvensScores', oddsEvensScores);

            // Add round to history
            oddsEvensGameHistory.push({
                roundNumber: oddsEvensGameHistory.length + 1,
                playerChoiceType: playerChoiceType,
                playerChoiceDisplayName: playerChoiceDisplayName,
                playerNumber: playerNumber,
                computerNumber: computerChoice,
                sum: sum,
                winningChoiceType: winningChoiceType,
                winningChoiceDisplayName: winningChoiceDisplayName,
                result: resultText,
                winner: winnerIndicator,
                timestamp: new Date().toLocaleTimeString()
            });
            setLocalStorageItem('oddsEvensGameHistory', oddsEvensGameHistory); // Save history to local storage
            renderOEHistory(); // Update history display


            // Check for series winner and update total series wins
            if (oddsEvensScores.player >= 2) {
                oeResultElem.textContent = "Series Over! You won the best of three!";
                oeResultElem.classList.remove('text-purple-700');
                oeResultElem.classList.add('text-green-600');
                seriesWinner = 'player'; 
            } else if (oddsEvensScores.computer >= 2) {
                oeResultElem.textContent = "Series Over! Computer won the best of three!";
                oeResultElem.classList.remove('text-purple-700');
                oeResultElem.classList.add('text-red-500');
                seriesWinner = 'computer'; 
            } else {
                oeResultElem.classList.remove('text-green-600', 'text-red-500');
                oeResultElem.classList.add('text-purple-700');
            }

            // Update total series wins if a series concluded
            if (seriesWinner === 'player') {
                oddsEvensTotalSeriesWins.player++;
                setLocalStorageItem('oddsEvensTotalSeriesWins', oddsEvensTotalSeriesWins);
                updateOddsEvensScoreboard(); // Update display immediately
            } else if (seriesWinner === 'computer') {
                oddsEvensTotalSeriesWins.computer++;
                setLocalStorageItem('oddsEvensTotalSeriesWins', oddsEvensTotalSeriesWins);
                updateOddsEvensScoreboard(); // Update display immediately
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize RPS DOM Elements
            rpsPlayerNameInput = document.getElementById('rpsPlayerNameInput');
            rpsPlayerScoreElem = document.getElementById('rpsPlayerScore');
            rpsComputerScoreElem = document.getElementById('rpsComputerScore');
            rpsPlayerChoiceElem = document.getElementById('rpsPlayerChoice');
            rpsComputerChoiceElem = document.getElementById('rpsComputerChoice');
            rpsResultElem = document.getElementById('rpsResult');
            rpsCurrentModeDisplay = document.getElementById('rpsCurrentMode');
            rpsButtonsContainer = document.getElementById('rpsButtonsContainer');
            rpsPlayerDisplayChoice = document.getElementById('rpsPlayerDisplayChoice');
            rpsTotalPlayerSeriesWinsElem = document.getElementById('rpsTotalPlayerSeriesWins');
            rpsTotalComputerSeriesWinsElem = document.getElementById('rpsTotalComputerSeriesWins');
            rpsTotalPlayerSeriesWinsText = document.getElementById('rpsTotalPlayerSeriesWinsText');
            modeRPSClassicBtn = document.getElementById('modeRPSClassic');
            modeRPSCustomFunBtn = document.getElementById('modeRPSCustomFun');
            modeRPSCreateNewBtn = document.getElementById('modeRPSCreateNew');
            modeRPSLoadSavedBtn = document.getElementById('modeRPSLoadSaved');
            createNewRPSRulesContainer = document.getElementById('createNewRPSRules');
            loadSavedRPSRulesContainer = document.getElementById('loadSavedRPSRules');
            newRPSGameNameInput = document.getElementById('newRPSGameName');
            customRPSRockInput = document.getElementById('customRPSRock');
            customRPSPaperInput = document.getElementById('customRPSPaper');
            customRPSSciInput = document.getElementById('customRPSScissors');
            saveNewRPSCustomRulesBtn = document.getElementById('saveNewRPSCustomRules');
            newRPSCustomGameMessage = document.getElementById('newRPSCustomGameMessage');
            savedRPSGameSelect = document.getElementById('savedRPSGameSelect');
            loadSelectedRPSCustomRulesBtn = document.getElementById('loadSelectedRPSCustomRules');
            loadRPSCustomGameMessage = document.getElementById('loadRPSCustomGameMessage');
            rpsGameHistoryListElem = document.getElementById('rpsGameHistoryList'); // Get history list element

            // Initialize Coin Flip DOM Elements
            coinFlipResultElem = document.getElementById('coinFlipResult');
            coinFlipPlayerScoreElem = document.getElementById('coinFlipPlayerScore'); 
            coinFlipComputerScoreElem = document.getElementById('coinFlipComputerScore'); 
            coinFlipTiesElem = document.getElementById('coinFlipTies'); 
            coinFlipButtons = document.querySelectorAll('.coin-flip-button');
            coinFlipCurrentModeDisplay = document.getElementById('coinFlipCurrentMode');
            cfPlayerNameInput = document.getElementById('cfPlayerNameInput');
            // Corrected IDs for Coin Flip total series wins
            coinFlipTotalPlayerSeriesWinsElem = document.getElementById('coinFlipTotalPlayerSeriesWins');
            coinFlipTotalComputerSeriesWinsElem = document.getElementById('coinFlipTotalComputerSeriesWins');
            coinFlipTotalPlayerSeriesWinsText = document.getElementById('coinFlipTotalPlayerSeriesWinsText');
            modeCFClassicBtn = document.getElementById('modeCFClassic');
            modeCFCustomFunBtn = document.getElementById('modeCFCustomFun');
            modeCFCreateNewBtn = document.getElementById('modeCFCreateNew');
            modeCFLoadSavedBtn = document.getElementById('modeCFLoadSaved');
            customFunCFRulesContainer = document.getElementById('customFunCFRules');
            presetCFGameSelect = document.getElementById('presetCFGameSelect');
            loadSelectedCFPresetBtn = document.getElementById('loadSelectedCFPreset');
            presetCFGameMessage = document.getElementById('presetCFGameMessage');
            createNewCFRulesContainer = document.getElementById('createNewCFRules');
            newCFGameNameInput = document.getElementById('newCFGameName');
            customCFSide1Input = document.getElementById('customCFSide1');
            customCFSide2Input = document.getElementById('customCFSide2');
            saveNewCFCustomRulesBtn = document.getElementById('saveNewCFCustomRules');
            newCFCustomGameMessage = document.getElementById('newCFCustomGameMessage');
            loadSavedCFRulesContainer = document.getElementById('loadSavedCFRules');
            savedCFGameSelect = document.getElementById('savedCFGameSelect');
            loadSelectedCFCustomRulesBtn = document.getElementById('loadSelectedCFCustomRules');
            loadCFCustomGameMessage = document.getElementById('loadCFCustomGameMessage');
            coinFlipGameHistoryListElem = document.getElementById('coinFlipGameHistoryList'); // Get history list element

            // Initialize Odds & Evens DOM Elements
            oePlayerChoiceElem = document.getElementById('oePlayerChoice');
            oeComputerChoiceElem = document.getElementById('oeComputerChoice');
            oeSumElem = document.getElementById('oeSum');
            oeResultElem = document.getElementById('oeResult');
            oePlayerScoreElem = document.getElementById('oePlayerScore'); 
            oeComputerScoreElem = document.getElementById('oeComputerScore'); 
            oeTiesElem = document.getElementById('oeTies');
            playerNumberInput = document.getElementById('playerNumber');
            oeChoiceButtons = document.querySelectorAll('.oe-choice-button');
            oeCurrentModeDisplay = document.getElementById('oeCurrentMode');
            oePlayerNameInput = document.getElementById('oePlayerNameInput');
            oeTotalPlayerSeriesWinsElem = document.getElementById('oeTotalPlayerSeriesWins');
            oeTotalComputerSeriesWinsElem = document.getElementById('oeTotalComputerSeriesWins');
            oeTotalPlayerSeriesWinsText = document.getElementById('oeTotalPlayerSeriesWinsText');
            modeOEClassicBtn = document.getElementById('modeOEClassic');
            modeOECustomFunBtn = document.getElementById('modeOECustomFun');
            modeOECreateNewBtn = document = document.getElementById('modeOECreateNew');
            modeOELoadSavedBtn = document.getElementById('modeOELoadSaved');
            createNewOERulesContainer = document.getElementById('createNewOERules');
            newOEGameNameInput = document.getElementById('newOEGameName');
            customOEOddsInput = document.getElementById('customOEOdds');
            customOEEvensInput = document = document.getElementById('customOEEvens');
            saveNewOECustomRulesBtn = document.getElementById('saveNewOECustomRules');
            newOECustomGameMessage = document.getElementById('newOECustomGameMessage');
            loadSavedOERulesContainer = document.getElementById('loadSavedOERules');
            savedOEGameSelect = document.getElementById('savedOEGameSelect');
            loadSelectedOECustomRulesBtn = document.getElementById('loadSelectedOECustomRules');
            loadOECustomGameMessage = document.getElementById('loadOECustomGameMessage');
            oeGameHistoryListElem = document.getElementById('oeGameHistoryList'); // Get history list element


            // RPS Mode Button Event Listeners
            modeRPSClassicBtn.addEventListener('click', () => setRPSMode('classic'));
            modeRPSCustomFunBtn.addEventListener('click', () => setRPSMode('customFun'));
            modeRPSCreateNewBtn.addEventListener('click', () => setRPSMode('createNew'));
            modeRPSLoadSavedBtn.addEventListener('click', () => setRPSMode('loadSaved'));

            // Save New Custom RPS Rules
            saveNewRPSCustomRulesBtn.addEventListener('click', () => {
                const gameName = newRPSGameNameInput.value.trim();
                const nameRock = customRPSRockInput.value.trim();
                const namePaper = customRPSPaperInput.value.trim();
                const nameScissors = customRPSSciInput.value.trim();

                if (!gameName || !nameRock || !namePaper || !nameScissors) {
                    newRPSCustomGameMessage.textContent = "Please fill in all fields.";
                    newRPSCustomGameMessage.classList.remove('text-green-600');
                    newRPSCustomGameMessage.classList.add('text-red-500');
                    return;
                }
                // Check for uniqueness of custom names (case-insensitive)
                if (new Set([nameRock.toLowerCase(), namePaper.toLowerCase(), nameScissors.toLowerCase()]).size < 3) {
                    newRPSCustomGameMessage.textContent = "All custom names must be unique (case-insensitive).";
                    newRPSCustomGameMessage.classList.remove('text-green-600');
                    newRPSCustomGameMessage.classList.add('text-red-500');
                    return;
                }
                // Check against both saved and custom fun presets (case-insensitive for game name)
                const gameNameLower = gameName.toLowerCase();
                const existingGameNames = Object.keys(savedCustomRPSRules).map(key => key.toLowerCase()).concat(Object.keys(RPS_CUSTOM_FUN_RULES).map(key => key.toLowerCase()));
                if (existingGameNames.includes(gameNameLower)) {
                    // Refined error message
                    newRPSCustomGameMessage.textContent = `Game '${gameName}' already exists (user-saved or preset). Choose a different name.`;
                    newRPSCustomGameMessage.classList.remove('text-green-600');
                    newRPSCustomGameMessage.classList.add('text-red-500');
                    return;
                }

                // Store rules using the exact casing entered by the user
                const newRules = {
                    [nameRock]: [nameScissors],
                    [namePaper]: [nameRock],
                    [nameScissors]: [namePaper]
                };

                savedCustomRPSRules[gameName] = newRules;
                setLocalStorageItem('savedCustomRPSRules', savedCustomRPSRules);
                newRPSCustomGameMessage.textContent = `Game '${gameName}' saved and loaded!`;
                newRPSCustomGameMessage.classList.remove('text-red-500');
                newRPSCustomGameMessage.classList.add('text-green-600');
                
                // Immediately use the newly created rules
                setRPSMode('loadedCustom', gameName);
                newRPSGameNameInput.value = ''; // Clear fields
                customRPSRockInput.value = '';
                customRPSPaperInput.value = '';
                customRPSSciInput.value = '';
            });

            // Populate Saved RPS Games Dropdown
            function populateSavedRPSGamesDropdown() {
                savedRPSGameSelect.innerHTML = '<option value="">-- Select a Saved Game --</option>';
                for (const name in savedCustomRPSRules) {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    savedRPSGameSelect.appendChild(option);
                }
                if (Object.keys(savedCustomRPSRules).length === 0) {
                    loadRPSCustomGameMessage.textContent = "No saved games found.";
                    loadRPSCustomGameMessage.classList.add('text-red-500');
                    loadSelectedRPSCustomRulesBtn.disabled = true; // Disable load button if no games
                } else {
                    loadRPSCustomGameMessage.textContent = "";
                    loadRPSCustomGameMessage.classList.remove('text-red-500');
                    loadSelectedRPSCustomRulesBtn.disabled = false;
                }
            }

            // Load Selected RPS Custom Rules
            loadSelectedRPSCustomRulesBtn.addEventListener('click', () => {
                const selectedGameName = savedRPSGameSelect.value;
                if (selectedGameName && savedCustomRPSRules[selectedGameName]) {
                    setRPSMode('loadedCustom', selectedGameName);
                    loadRPSCustomGameMessage.textContent = `Game '${selectedGameName}' loaded!`;
                    loadRPSCustomGameMessage.classList.remove('text-red-500');
                    loadRPSCustomGameMessage.classList.add('text-green-600');
                } else {
                    loadRPSCustomGameMessage.textContent = "Please select a valid game to load.";
                    loadRPSCustomGameMessage.classList.add('text-red-500');
                    loadRPSCustomGameMessage.classList.remove('text-green-600');
                }
            });

            // Event listener for RPS player name input
            rpsPlayerNameInput.addEventListener('input', updateRPSScoreboard);

            // Initial setup for RPS
            setRPSMode('classic');
            updateRPSScoreboard();
            renderRPSHistory(); // Initial render of history

            // Coin Flip Mode Button Event Listeners
            modeCFClassicBtn.addEventListener('click', () => setCoinFlipMode('classic'));
            modeCFCustomFunBtn.addEventListener('click', () => setCoinFlipMode('customFun'));
            modeCFCreateNewBtn.addEventListener('click', () => setCoinFlipMode('createNew'));
            modeCFLoadSavedBtn.addEventListener('click', () => setCoinFlipMode('loadSaved'));

            // Load Selected CF Preset
            loadSelectedCFPresetBtn.addEventListener('click', () => {
                const selectedPresetName = presetCFGameSelect.value;
                if (selectedPresetName && CF_CUSTOM_FUN_PRESETS[selectedPresetName]) {
                    setCoinFlipMode('loadedPreset', selectedPresetName);
                    presetCFGameMessage.textContent = `Preset '${selectedPresetName}' loaded!`;
                    presetCFGameMessage.classList.remove('text-red-500');
                    presetCFGameMessage.classList.add('text-green-600');
                } else {
                    presetCFGameMessage.textContent = "Please select a valid preset to load.";
                    presetCFGameMessage.classList.add('text-red-500');
                    presetCFGameMessage.classList.remove('text-green-600');
                }
            });

            // Save New Custom Coin Rules
            saveNewCFCustomRulesBtn.addEventListener('click', () => {
                const gameName = newCFGameNameInput.value.trim();
                const side1 = customCFSide1Input.value.trim();
                const side2 = customCFSide2Input.value.trim();

                if (!gameName || !side1 || !side2) {
                    newCFCustomGameMessage.textContent = "Please fill in all fields.";
                    newCFCustomGameMessage.classList.remove('text-green-600');
                    newCFCustomGameMessage.classList.add('text-red-500');
                    return;
                }
                if (side1.toLowerCase() === side2.toLowerCase()) {
                    newCFCustomGameMessage.textContent = "Side names must be unique (case-insensitive).";
                    newCFCustomGameMessage.classList.remove('text-green-600');
                    newCFCustomGameMessage.classList.add('text-red-500');
                    return;
                }
                const gameNameLower = gameName.toLowerCase();
                const existingGameNames = Object.keys(savedCustomCFRules).map(key => key.toLowerCase()).concat(Object.keys(CF_CUSTOM_FUN_PRESETS).map(key => key.toLowerCase()));
                if (existingGameNames.includes(gameNameLower)) {
                    // Refined error message
                    newCFCustomGameMessage.textContent = `Game '${gameName}' already exists (user-saved or preset). Choose a different name.`;
                    newCFCustomGameMessage.classList.remove('text-green-600');
                    newCFCustomGameMessage.classList.add('text-red-500');
                    return;
                }

                savedCustomCFRules[gameName] = [side1, side2];
                setLocalStorageItem('savedCustomCFRules', savedCustomCFRules);
                newCFCustomGameMessage.textContent = `Game '${gameName}' saved and loaded!`;
                newCFCustomGameMessage.classList.remove('text-red-500');
                newCFCustomGameMessage.classList.add('text-green-600');
                
                setCoinFlipMode('loadedCustom', gameName);
                newCFGameNameInput.value = '';
                customCFSide1Input.value = '';
                customCFSide2Input.value = '';
            });

            // Load Selected CF Custom Rules
            loadSelectedCFCustomRulesBtn.addEventListener('click', () => {
                const selectedGameName = savedCFGameSelect.value;
                if (selectedGameName && savedCustomCFRules[selectedGameName]) {
                    setCoinFlipMode('loadedCustom', selectedGameName);
                    loadCFCustomGameMessage.textContent = `Game '${selectedGameName}' loaded!`;
                    loadCFCustomGameMessage.classList.remove('text-red-500');
                    loadCFCustomGameMessage.classList.add('text-green-600');
                } else {
                    loadCFCustomGameMessage.textContent = "Please select a valid game to load.";
                    loadCFCustomGameMessage.classList.add('text-red-500');
                    loadCFCustomGameMessage.classList.remove('text-green-600');
                }
            });

            // Event listeners for Coin Flip game buttons
            coinFlipButtons.forEach(button => {
                button.addEventListener('click', (e) => playCoinFlip(e.target.dataset.choice));
            });

            // Event listener for Coin Flip player name input
            cfPlayerNameInput.addEventListener('input', updateCoinFlipScoreboard);

            // Initial setup for Coin Flip
            setCoinFlipMode('classic');
            updateCoinFlipScoreboard();
            renderCoinFlipHistory(); // Initial render of history


            // OE Mode Button Event Listeners
            modeOEClassicBtn.addEventListener('click', () => setOddsEvensMode('classic'));
            modeOECustomFunBtn.addEventListener('click', () => setOddsEvensMode('customFun'));
            modeOECreateNewBtn.addEventListener('click', () => setOddsEvensMode('createNew'));
            modeOELoadSavedBtn.addEventListener('click', () => setOddsEvensMode('loadSaved'));

            // Save New Custom OE Rules
            saveNewOECustomRulesBtn.addEventListener('click', () => {
                const gameName = newOEGameNameInput.value.trim();
                const oddsName = customOEOddsInput.value.trim();
                const evensName = customOEEvensInput.value.trim();

                if (!gameName || !oddsName || !evensName) {
                    newOECustomGameMessage.textContent = "Please fill in all fields.";
                    newOECustomGameMessage.classList.remove('text-green-600');
                    newOECustomGameMessage.classList.add('text-red-500');
                    return;
                }
                if (oddsName.toLowerCase() === evensName.toLowerCase()) {
                    newOECustomGameMessage.textContent = "'Odds' and 'Evens' names must be unique (case-insensitive).";
                    newOECustomGameMessage.classList.remove('text-green-600');
                    newOECustomGameMessage.classList.add('text-red-500');
                    return;
                }
                const gameNameLower = gameName.toLowerCase();
                const existingGameNames = Object.keys(savedCustomOERules).map(key => key.toLowerCase()).concat(Object.keys(OE_CUSTOM_FUN_PRESETS).map(key => key.toLowerCase()));
                if (existingGameNames.includes(gameNameLower)) {
                    // Refined error message
                    newOECustomGameMessage.textContent = `Game '${gameName}' already exists (user-saved or preset). Choose a different name.`;
                    newOECustomGameMessage.classList.remove('text-green-600');
                    newOECustomGameMessage.classList.add('text-red-500');
                    return;
                }

                savedCustomOERules[gameName] = [oddsName, evensName];
                setLocalStorageItem('savedCustomOERules', savedCustomOERules);
                newOECustomGameMessage.textContent = `Game '${gameName}' saved and loaded!`;
                newOECustomGameMessage.classList.remove('text-red-500');
                newOECustomGameMessage.classList.add('text-green-600');
                
                setOddsEvensMode('loadedCustom', gameName);
                newOEGameNameInput.value = '';
                customOEOddsInput.value = '';
                customOEEvensInput.value = '';
            });

            // Load Selected OE Custom Rules
            loadSelectedOECustomRulesBtn.addEventListener('click', () => {
                const selectedGameName = savedOEGameSelect.value;
                if (selectedGameName && savedCustomOERules[selectedGameName]) {
                    setOddsEvensMode('loadedCustom', selectedGameName);
                    loadOECustomGameMessage.textContent = `Game '${selectedGameName}' loaded!`;
                    loadOECustomGameMessage.classList.remove('text-red-500');
                    loadOECustomGameMessage.classList.add('text-green-600');
                } else {
                    loadOECustomGameMessage.textContent = "Please select a valid game to load.";
                    loadOECustomGameMessage.classList.add('text-red-500');
                    loadOECustomGameMessage.classList.remove('text-green-600');
                }
            });

            // Event listeners for Odds & Evens game buttons
            oeChoiceButtons.forEach(button => {
                button.addEventListener('click', (e) => playOddsEvens(e.target.dataset.choice));
            });

            // Event listener for Odds & Evens player name input
            oePlayerNameInput.addEventListener('input', updateOddsEvensScoreboard);

            // Initial setup for Odds & Evens
            setOddsEvensMode('classic');
            updateOddsEvensScoreboard();
            renderOEHistory(); // Initial render of history

            // Ensure player number input updates the value correctly
            playerNumberInput.addEventListener('input', () => {
                // Ensure the value is always a positive integer
                let val = parseInt(playerNumberInput.value);
                if (isNaN(val) || val < 1) {
                    playerNumberInput.value = 1;
                }
            });

            // Initialize with RPS game shown
            showGame('rpsGame');
        });
    </script>
</body>
</html>
